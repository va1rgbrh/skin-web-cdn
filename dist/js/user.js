"use strict";var initCloset=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1===$("#closet-container").length){e.next=2;break}return e.abrupt("return");case 2:return $("input[name=q]").on("input",debounce(function(){var e=$("#skin-category").hasClass("active")?"skin":"cape";reloadCloset(e,1,$("input[name=q]").val())},350)),e.prev=3,e.next=6,fetch({type:"GET",url:url("/user/closet-data"),dataType:"json"});case 6:t=e.sent,r=t.items,n=t.category,a=t.total_pages,renderCloset(r,n),$("#closet-paginator").jqPaginator($.extend({},$.defaultPaginatorConfig,{totalPages:a,onPageChange:function(e){return reloadCloset($("#skin-category").hasClass("active")?"skin":"cape",e,$("input[name=q]").val())}})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),showAjaxError(e.t0);case 17:case"end":return e.stop()}},e,this,[[3,14]])}));return function(){return e.apply(this,arguments)}}(),reloadCloset=function(){var n=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var a,s,o,i,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch({type:"GET",url:url("user/closet-data"),dataType:"json",data:{category:t,page:r,perPage:getCapacityOfCloset(),q:n}});case 3:a=e.sent,s=a.items,o=a.category,i=a.total_pages,renderCloset(s,o),(c=$("#closet-paginator")).attr("last-"+o+"-page",r),c.jqPaginator("option",{currentPage:r,totalPages:i}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),showAjaxError(e.t0);case 16:case"end":return e.stop()}},e,this,[[0,13]])}));return function(e,t,r){return n.apply(this,arguments)}}(),renameClosetItem=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var n,a,s,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n="",e.prev=1,e.next=4,swal({title:trans("user.renameClosetItem"),input:"text",inputValue:r,showCancelButton:!0,inputValidator:function(r){return new Promise(function(e,t){r?e():t(trans("skinlib.emptyNewTextureName"))})}});case 4:n=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return");case 10:return e.prev=10,e.next=13,fetch({type:"POST",url:url("user/closet/rename"),dataType:"json",data:{tid:t,new_name:n}});case 13:a=e.sent,s=a.errno,o=a.msg,0===s?(i=$("[tid="+t+"]").data("texture-type"),$("[tid="+t+"]>.item-footer>.texture-name>span").html(n+" <small>("+i+")</small>"),toastr.success(o)):toastr.warning(o),e.next=22;break;case 19:e.prev=19,e.t1=e.catch(10),showAjaxError(e.t1);case 22:case"end":return e.stop()}},e,this,[[1,7],[10,19]])}));return function(e,t){return r.apply(this,arguments)}}(),removeFromCloset=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,swal({text:trans("user.removeFromClosetNotice"),type:"warning",showCancelButton:!0});case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return");case 8:return e.prev=8,e.next=11,fetch({type:"POST",url:url("user/closet/remove"),dataType:"json",data:{tid:t}});case 11:r=e.sent,n=r.errno,a=r.msg,0===n?(swal({type:"success",html:a}),$("div[tid="+t+"]").remove(),["skin","cape"].forEach(function(e){var t=$("#"+e+"-category");if(""===$.trim(t.html())){var r=trans("user.emptyClosetMsg",{url:url("skinlib?filter="+e)});t.html('<div class="empty-msg">'+r+"</div>")}})):toastr.warning(a),e.next=20;break;case 17:e.prev=17,e.t1=e.catch(8),showAjaxError(e.t1);case 20:case"end":return e.stop()}},e,this,[[0,5],[8,17]])}));return function(e){return t.apply(this,arguments)}}(),setAsAvatar=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,swal({title:trans("user.setAvatar"),text:trans("user.setAvatarNotice"),type:"question",showCancelButton:!0});case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return");case 8:return e.prev=8,e.next=11,fetch({type:"POST",url:url("user/profile/avatar"),dataType:"json",data:{tid:t}});case 11:r=e.sent,n=r.errno,a=r.msg,0===n?(toastr.success(a),$('[alt="User Image"]').each(function(){$(this).prop("src",$(this).attr("src")+"?"+(new Date).getTime())})):toastr.warning(a),e.next=20;break;case 17:e.prev=17,e.t1=e.catch(8),showAjaxError(e.t1);case 20:case"end":return e.stop()}},e,this,[[0,5],[8,17]])}));return function(e){return t.apply(this,arguments)}}(),setTexture=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a,s,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=$("#textures-indicator"),r=0,n=t.data("skin"),a=t.data("cape"),$('input[name="player"]').each(function(){this.checked&&(r=this.id)}),r){e.next=8;break}toastr.info(trans("user.emptySelectedPlayer")),e.next=24;break;case 8:if(n||a){e.next=12;break}toastr.info(trans("user.emptySelectedTexture")),e.next=24;break;case 12:return e.prev=12,e.next=15,fetch({type:"POST",url:url("user/player/set"),dataType:"json",data:{pid:r,"tid[skin]":n,"tid[cape]":a}});case 15:s=e.sent,o=s.errno,i=s.msg,0===o?(swal({type:"success",html:i}),$("#modal-use-as").modal("hide")):toastr.warning(i),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(12),showAjaxError(e.t0);case 24:case"end":return e.stop()}},e,this,[[12,21]])}));return function(){return e.apply(this,arguments)}}();function _asyncToGenerator(e){return function(){var i=e.apply(this,arguments);return new Promise(function(a,s){function o(e,t){try{var r=i[e](t),n=r.value}catch(e){return void s(e)}if(!r.done)return Promise.resolve(n).then(function(e){o("next",e)},function(e){o("throw",e)});a(n)}return o("next")})}}function renderClosetItemComponent(e){return e.name=$.fn.dataTable.render.text().filter(e.name),'\n    <div class="item" tid="'+e.tid+'" data-texture-type="'+e.type+'">\n        <div class="item-body">\n            <img src="'+url("/")+"preview/"+e.tid+'.png">\n        </div>\n        <div class="item-footer">\n            <p class="texture-name">\n                <span title="'+e.name+'">'+e.name+" <small>("+e.type+')</small></span>\n            </p>\n\n            <a href="'+url("/")+"skinlib/show/"+e.tid+'" title="'+trans("user.viewInSkinlib")+'" class="more" data-toggle="tooltip" data-placement="bottom"><i class="fa fa-share"></i></a>\n            <span title="'+trans("general.more")+'" class="more" data-toggle="dropdown" aria-haspopup="true" id="more-button"><i class="fa fa-cog"></i></span>\n\n            <ul class="dropup dropdown-menu" aria-labelledby="more-button">\n                <li><a onclick="renameClosetItem('+e.tid+", '"+e.name+"');\">"+trans("user.renameItem")+'</a></li>\n                <li><a onclick="removeFromCloset('+e.tid+');">'+trans("user.removeItem")+'</a></li>\n                <li><a onclick="setAsAvatar('+e.tid+');">'+trans("user.setAsAvatar")+"</a></li>\n            </ul>\n        </div>\n    </div>\n    "}function renderCloset(e,t){var r=$("input[name=q]").val(),n=$("#"+t+"-category").html("");0===e.length?($("#closet-paginator").hide(),""===r?n.html('<div class="empty-msg">'+trans("user.emptyClosetMsg",{url:url("skinlib?filter="+t)})+"</div>"):n.html('<div class="empty-msg">'+trans("general.noResult")+"</div>")):($("#closet-paginator").show(),n.html(e.reduce(function(e,t){return e+renderClosetItemComponent(t)},"")))}function getCapacityOfCloset(){return 2*~~($("#skin-category").width()/($(".item").width()+parseFloat($(".item").css("margin-right"))))}$(document).ready(_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,initCloset();case 2:void 0!==(t=getQueryString("tid"))&&$("[tid="+t+"]").children(".item-body").click();case 4:case"end":return e.stop()}},e,void 0)}))),$("body").on("click",".item-body",_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a,s,o,i,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return $(".item-selected").parent().removeClass("item-selected"),t=$(this).parent(),r=$("#textures-indicator"),t.addClass("item-selected"),n=parseInt(t.attr("tid")),e.prev=5,e.next=8,fetch({type:"POST",url:url("skinlib/info/"+n),dataType:"json"});case 8:a=e.sent,s=a.type,o=a.hash,"cape"===s?($.msp.config.capeUrl=url("textures/"+o),r.data("cape",n)):($.msp.config.skinUrl=url("textures/"+o),r.data("skin",n)),"alex"===s&&!$.msp.config.slim||"steve"===s&&$.msp.config.slim?($.msp.config.slim="alex"===s,initSkinViewer()):applySkinViewerConfig(),i=r.data("skin"),c=r.data("cape"),void 0!==i&&void 0!==c?r.text(trans("general.skin")+" & "+trans("general.cape")):i?r.text(trans("general.skin")):c&&r.text(trans("general.cape")),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(5),showAjaxError(e.t0);case 21:case"end":return e.stop()}},e,this,[[5,18]])}))),$("body").on("click",".category-switch",function(){var e=$('a[href="#skin-category"]').parent().hasClass("active")?"cape":"skin",t=$("input[name=q]").val(),r=parseInt($("#closet-paginator").attr("last-"+e+"-page"));reloadCloset(e,r,t)}),$("#closet-reset").click(function(){var e=$("#textures-indicator");e.text(""),e.removeData("skin"),e.removeData("cape"),$.msp.config.skinUrl=defaultSteveSkin,$.msp.config.capeUrl="",$.msp.config.slim=!1,initSkinViewer()});var showPlayerTexturePreview=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,s,o,i,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch({type:"GET",url:url("user/player/show"),dataType:"json",data:{pid:t}});case 3:r=e.sent,n=!1,a=["steve","alex","cape"],s=0;case 7:if(!(s<a.length)){e.next=24;break}if(o=a[s],!(i=r["tid_"+o])){e.next=19;break}return $("#"+o).attr("src",url("preview/200/"+i+".png")).show().parent().attr("href",url("skinlib/show/"+i)).next().hide(),e.next=14,fetch({type:"GET",url:url("skinlib/info/"+i),dataType:"json"});case 14:c=e.sent,u=c.hash,"cape"===o?$.msp.config.capeUrl=url("textures/"+u):o===("slim"===r.preference?"alex":"steve")&&($.msp.config.skinUrl=url("textures/"+u)),e.next=21;break;case 19:$("#"+o).hide().parent().next().show(),"cape"===o?$.msp.config.capeUrl="":o===("slim"===r.preference?"alex":"steve")&&($.msp.config.skinUrl="steve"===o?defaultSteveSkin:defaultAlexSkin);case 21:s++,e.next=7;break;case 24:$.msp.config.slim!==("slim"===r.preference)&&($.msp.config.slim=!$.msp.config.slim,n=!0),$.msp.config.skinUrl===$.msp.viewer.skinUrl&&$.msp.config.capeUrl===$.msp.viewer.capeUrl||(n=!0),n&&(initSkinViewer(),console.log("[skinview3d] texture previews of player "+r.player_name+" rendered")),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(0),showAjaxError(e.t0);case 32:case"end":return e.stop()}},e,this,[[0,29]])}));return function(e){return t.apply(this,arguments)}}(),changePlayerName=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,s,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="",n=$("tr#"+t+" td.player-name"),e.prev=2,e.next=5,swal({title:trans("user.changePlayerName"),text:$("#player_name").attr("placeholder"),inputValue:n.html(),input:"text",showCancelButton:!0,inputValidator:function(r){return new Promise(function(e,t){r?e():t(trans("user.emptyPlayerName"))})}});case 5:r=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return");case 11:return e.prev=11,e.next=14,fetch({type:"POST",url:url("user/player/rename"),dataType:"json",data:{pid:t,new_player_name:r}});case 14:a=e.sent,s=a.errno,o=a.msg,0===s?(swal({type:"success",html:o}),n.html(r)):swal({type:"warning",html:o}),e.next=23;break;case 20:e.prev=20,e.t1=e.catch(11),showAjaxError(e.t1);case 23:case"end":return e.stop()}},e,this,[[2,8],[11,20]])}));return function(e){return t.apply(this,arguments)}}(),ajaxClearTexture=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if($(".modal").each(function(){"none"===$(this).css("display")&&$(this).remove()}),r={pid:t},["steve","alex","cape"].forEach(function(e){r[e]=$("#clear-"+e).prop("checked")?1:0}),0!==r.steve||0!==r.alex||0!==r.cape){e.next=5;break}return e.abrupt("return",toastr.warning(trans("user.noClearChoice")));case 5:return e.prev=5,e.next=8,fetch({type:"POST",url:url("user/player/texture/clear"),dataType:"json",data:r});case 8:n=e.sent,a=n.errno,s=n.msg,swal({type:0===a?"success":"error",html:s}),$(".modal").modal("hide"),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),showAjaxError(e.t0);case 18:case"end":return e.stop()}},e,this,[[5,15]])}));return function(e){return t.apply(this,arguments)}}(),deletePlayer=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,swal({title:trans("user.deletePlayer"),text:trans("user.deletePlayerNotice"),type:"warning",showCancelButton:!0,cancelButtonColor:"#3085d6",confirmButtonColor:"#d33"});case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return");case 8:return e.prev=8,e.next=11,fetch({type:"POST",url:url("user/player/delete"),dataType:"json",data:{pid:t}});case 11:if(r=e.sent,n=r.errno,a=r.msg,0!==n){e.next=20;break}return e.next=17,swal({type:"success",html:a});case 17:$("tr#"+t).remove(),e.next=21;break;case 20:swal({type:"warning",html:a});case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(8),showAjaxError(e.t1);case 26:case"end":return e.stop()}},e,this,[[0,5],[8,23]])}));return function(e){return t.apply(this,arguments)}}(),addNewPlayer=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch({type:"POST",url:url("user/player/add"),dataType:"json",data:{player_name:$("#player_name").val()}});case 3:if(t=e.sent,r=t.errno,n=t.msg,0!==r){e.next=13;break}return e.next=9,swal({type:"success",html:n});case 9:$("#modal-add-player").modal("hide"),location.reload(),e.next=14;break;case 13:swal({type:"warning",html:n});case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),showAjaxError(e.t0);case 19:case"end":return e.stop()}},e,this,[[0,16]])}));return function(){return e.apply(this,arguments)}}();function _asyncToGenerator(e){return function(){var i=e.apply(this,arguments);return new Promise(function(a,s){function o(e,t){try{var r=i[e](t),n=r.value}catch(e){return void s(e)}if(!r.done)return Promise.resolve(n).then(function(e){o("next",e)},function(e){o("throw",e)});a(n)}return o("next")})}}function clearTexture(e){var t='<div class="form-group">\n        <input type="checkbox" id="clear-steve"> Default (Steve)\n    </div>\n    <div class="form-group">\n        <input type="checkbox" id="clear-alex"> Slim (Alex)\n    </div>\n    <div class="form-group">\n        <input type="checkbox" id="clear-cape"> '+trans("general.cape")+"\n    </div>\n    <script>\n        $('input[type=checkbox]').iCheck({ checkboxClass: 'icheckbox_square-blue' });\n    <\/script>";return showModal(t,trans("user.chooseClearTexture"),"default",{callback:"ajaxClearTexture("+e+")"})}$("body").on("click",".player",function(){$(".player-selected").removeClass("player-selected"),$(this).addClass("player-selected"),showPlayerTexturePreview(this.id)}).on("change","#preference",_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch({type:"POST",url:url("user/player/preference"),dataType:"json",data:{pid:$(this).attr("pid"),preference:$(this).val()}});case 3:t=e.sent,r=t.errno,n=t.msg,0===r?toastr.success(n):toastr.warning(n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),showAjaxError(e.t0);case 12:case"end":return e.stop()}},e,this,[[0,9]])}))).on("click","#preview-switch",function(){$("#preview-3d-container").toggle(),$("#preview-2d-container").toggle(),$(".operations").toggle(),$("#preview-3d-container").is(":visible")?$("#preview-switch").html(trans("user.switch2dPreview")):$("#preview-switch").html(trans("user.switch3dPreview"))});var changeNickName=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=$("#new-nickname").val()){e.next=3;break}return e.abrupt("return",swal({type:"error",html:trans("user.emptyNewNickName")}));case 3:return e.prev=3,e.next=6,swal({text:trans("user.changeNickName",{new_nickname:t}),type:"question",showCancelButton:!0});case 6:e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(3),e.abrupt("return");case 11:return e.prev=11,e.next=14,fetch({type:"POST",url:url("user/profile?action=nickname"),dataType:"json",data:{new_nickname:t}});case 14:if(r=e.sent,n=r.errno,a=r.msg,0!==n){e.next=22;break}return $(".nickname").each(function(){$(this).html(t)}),e.abrupt("return",swal({type:"success",html:a}));case 22:return e.abrupt("return",swal({type:"warning",html:a}));case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(11),showAjaxError(e.t1);case 28:case"end":return e.stop()}},e,this,[[3,8],[11,25]])}));return function(){return e.apply(this,arguments)}}(),changePassword=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a,s,o,i,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=$("#password"),r=$("#new-passwd"),n=$("#confirm-pwd"),a=t.val(),s=r.val(),""!==a){e.next=7;break}toastr.info(trans("user.emptyPassword")),t.focus(),e.next=40;break;case 7:if(""!==s){e.next=12;break}toastr.info(trans("user.emptyNewPassword")),r.focus(),e.next=40;break;case 12:if(""!==n.val()){e.next=17;break}toastr.info(trans("auth.emptyConfirmPwd")),n.focus(),e.next=40;break;case 17:if(s===n.val()){e.next=22;break}toastr.warning(trans("auth.invalidConfirmPwd")),n.focus(),e.next=40;break;case 22:return e.prev=22,e.next=25,fetch({type:"POST",url:url("user/profile?action=password"),dataType:"json",data:{current_password:a,new_password:s}});case 25:if(o=e.sent,i=o.errno,c=o.msg,0!==i){e.next=34;break}return e.next=31,swal({type:"success",text:c});case 31:return e.abrupt("return",window.location=url("auth/login"));case 34:return e.abrupt("return",swal({type:"warning",text:c}));case 35:e.next=40;break;case 37:e.prev=37,e.t0=e.catch(22),showAjaxError(e.t0);case 40:case"end":return e.stop()}},e,this,[[22,37]])}));return function(){return e.apply(this,arguments)}}(),changeEmail=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=$("#new-email").val()){e.next=3;break}return e.abrupt("return",swal({type:"error",html:trans("user.emptyNewEmail")}));case 3:if(/\S+@\S+\.\S+/.test(t)){e.next=5;break}return e.abrupt("return",swal({type:"warning",html:trans("auth.invalidEmail")}));case 5:return e.prev=5,e.next=8,swal({text:trans("user.changeEmail",{new_email:t}),type:"question",showCancelButton:!0});case 8:e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(5),e.abrupt("return");case 13:return e.prev=13,e.next=16,fetch({type:"POST",url:url("user/profile?action=email"),dataType:"json",data:{new_email:t,password:$("#current-password").val()}});case 16:if(r=e.sent,n=r.errno,a=r.msg,0!==n){e.next=25;break}return e.next=22,swal({type:"success",text:a});case 22:return e.abrupt("return",window.location=url("auth/login"));case 25:return e.abrupt("return",swal({type:"warning",text:a}));case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(13),showAjaxError(e.t1);case 31:case"end":return e.stop()}},e,this,[[5,10],[13,28]])}));return function(){return e.apply(this,arguments)}}(),deleteAccount=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=$(".modal-body>#password").val()){e.next=3;break}return e.abrupt("return",swal({type:"warning",html:trans("user.emptyDeletePassword")}));case 3:return e.prev=3,e.next=6,fetch({type:"POST",url:url("user/profile?action=delete"),dataType:"json",data:{password:t}});case 6:if(r=e.sent,n=r.errno,a=r.msg,0!==n){e.next=15;break}return e.next=12,swal({type:"success",html:a});case 12:window.location=url("auth/login"),e.next=16;break;case 15:return e.abrupt("return",swal({type:"warning",html:a}));case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(3),showAjaxError(e.t0);case 21:case"end":return e.stop()}},e,this,[[3,18]])}));return function(){return e.apply(this,arguments)}}();function _asyncToGenerator(e){return function(){var i=e.apply(this,arguments);return new Promise(function(a,s){function o(e,t){try{var r=i[e](t),n=r.value}catch(e){return void s(e)}if(!r.done)return Promise.resolve(n).then(function(e){o("next",e)},function(e){o("throw",e)});a(n)}return o("next")})}}$("#new-email").focusin(function(){$("#current-password").parent().show()}).focusout(debounce(function(){var e=$("#current-password");e.is(":focus")||e.parent().hide()},10));var sign=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch({type:"POST",url:url("user/sign"),dataType:"json"});case 3:if(0!==(t=e.sent).errno){e.next=13;break}return $("#score").html(t.score),r='<i class="fa fa-calendar-check-o"></i> &nbsp;'+trans("user.signRemainingTime",1<=t.remaining_time?{time:t.remaining_time.toString(),unit:trans("user.timeUnitHour")}:{time:(60*t.remaining_time).toFixed(),unit:trans("user.timeUnitMin")}),$("#sign-button").attr("disabled","disabled").html(r),1024<t.storage.used?$("#user-storage").html("<b>"+Math.round(t.storage.used/1024)+"</b>/ "+Math.round(t.storage.total/1024)+" MB"):$("#user-storage").html("<b>"+Math.round(t.storage.used)+"</b>/ "+Math.round(t.storage.total)+" KB"),$("#user-storage-bar").css("width",t.storage.percentage+"%"),e.abrupt("return",swal({type:"success",html:t.msg}));case 13:toastr.warning(t.msg);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),showAjaxError(e.t0);case 19:case"end":return e.stop()}},e,this,[[0,16]])}));return function(){return e.apply(this,arguments)}}();function _asyncToGenerator(e){return function(){var i=e.apply(this,arguments);return new Promise(function(a,s){function o(e,t){try{var r=i[e](t),n=r.value}catch(e){return void s(e)}if(!r.done)return Promise.resolve(n).then(function(e){o("next",e)},function(e){o("throw",e)});a(n)}return o("next")})}}function _asyncToGenerator(e){return function(){var i=e.apply(this,arguments);return new Promise(function(s,o){return function t(e,r){try{var n=i[e](r),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});s(a)}("next")})}}$("#send-verification-email").click(_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch({type:"POST",url:url("user/email-verification"),dataType:"json",beforeSend:function(){$("#send-verification-email").hide(),$("#sending-indicator").show()}});case 3:t=e.sent,r=t.errno,n=t.msg,swal({type:0===r?"success":"warning",html:n}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),showAjaxError(e.t0);case 12:$("#send-verification-email").show(),$("#sending-indicator").hide();case 14:case"end":return e.stop()}},e,void 0,[[0,9]])})));